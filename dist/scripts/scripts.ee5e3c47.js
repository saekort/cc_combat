"use strict";angular.module("ccCombatApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.sortable","toaster"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),function(){function a(a,c){this.newInitiative={},this.combat=this.loadCombat(),this.showAddControls=!0,this.toaster=c,this.demo=a.search().demo?!0:!1,this.demo&&(this.combat=[new b("Ragnor the Red",11,"pc"),new b("Violet the Vile",16,"pc"),new b("Nightstalker Nydia",4,"pc"),new b("Peter Patronum",26,"pc"),new b("Neruban Ninja",3,"pc"),new b("Barry the Bugbear",14,"monster")]),this.sort="-init",this.mode="input",this.quotes=["Roll for initiative monkey boy!","Just theoretically, how does one unsummon a demon?","What a useless scroll. It just says, HASTUR HASTUR HASTUR over and over again...","He hit me for HOW MUCH?????","AAAAAAAAAAAAAAAAAAAAAAAAHHHHHHH!","Don't worry, he is probably just first level.","I have this dungeon at home, I know where everything is!","I see HOW MANY wights?!","A Nightmare, huh? I'll attack for one round and prepare to run.","They need a twenty to hit me, I'm invincible","OK! I moon the Balrog!","Well, we know he's LAWFUL evil, so he should keep his word when he promised not to betray us.","Yeah, I know it's dangerous, but think of the experience points.","They can't see me. I'm invisible!","They don't look so tough.","What do you mean trolls regenerate!?!","Those noises are probably nothing.","He shot out my eye? Okay, I tear out my other eye and throw it at him as a gesture of defiance.","This is a push-over dungeon.","I know an illusion when I see one.","Is this one really able to breath fire?","Thereâ€™s no such thing as a bottomless pit. Everybody knows that.","I spent seven hours rolling this guy up"],this.quote=this.getQuote()}function b(a,b,c){this.id=this.guid(),this.name=a,this.init=b,this.type=c,this.delay=!1,this.ready=!1}a.$inject=["$location","toaster"],a.prototype.addInitiative=function(){"combat"===this.mode?this.combat.unshift(new b(this.newInitiative.name,"N",this.newInitiative.type)):this.combat.push(new b(this.newInitiative.name,parseInt(this.newInitiative.init),this.newInitiative.type)),this.counter++;var a=this.newInitiative.name;this.newInitiative.name="",this.newInitiative.init="",this.newInitiative.type="",document.getElementById("newInitiative.name").focus(),this.toaster.pop("success","Challenger approaching!",a+" added to combat"),"combat"===this.mode&&(this.showAddControls=!1),this.saveCombat()},a.prototype.removeInitiative=function(a){var b=this.findWithAttr(this.combat,"id",a.id);this.combat.splice(b,1),this.toaster.pop("error","Looks like something died",a.name+" removed from combat"),this.saveCombat()},a.prototype.setMode=function(a){"combat"===a&&(this.combat.sort(function(a,b){return a.init<b.init?1:a.init>b.init?-1:0}),this.sort="",this.mode=a,this.showAddControls=!1,this.toaster.pop("warning","Here we go!","Combat started"),this.newInitiative.name="",this.newInitiative.init="",this.newInitiative.type="")},a.prototype.nextInit=function(){var a=this.combat.shift();this.combat.push(a),this.saveCombat()},a.prototype.previousInit=function(){var a=this.combat.pop();this.combat.unshift(a),this.saveCombat()},a.prototype.setDelay=function(){var a=this.combat[0];a.delay=!0,this.nextInit(),this.saveCombat()},a.prototype.setReady=function(){var a=this.combat[0];a.ready=!0,this.nextInit(),this.saveCombat()},a.prototype.takeDelay=function(a){var b=this.combat[a];b.delay=!1,this.combat.splice(a,1),this.combat.unshift(b),this.saveCombat()},a.prototype.takeReady=function(a){var b=this.combat[a];b.ready=!1,this.combat.splice(a,1),this.combat.unshift(b),this.saveCombat()},a.prototype.findWithAttr=function(a,b,c){for(var d=0;d<a.length;d+=1)if(a[d][b]===c)return d},a.prototype.saveCombat=function(){localStorage.setItem("combat",JSON.stringify(this.combat))},a.prototype.loadCombat=function(){if(localStorage.getItem("combat"))return JSON.parse(localStorage.getItem("combat"));var a=[];return a},a.prototype.resetCombat=function(){localStorage.removeItem("combat"),this.combat=this.loadCombat(),this.showAddControls=!0,this.mode="input",this.toaster.pop("error","Combat reset","Now go kill some PCs!")},a.prototype.getQuote=function(){return this.quotes[Math.floor(Math.random()*this.quotes.length)]},b.$inject=["name","init","type"],b.prototype.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),angular.module("ccCombatApp").controller("MainCtrl",a).factory("Initiative",b)}(),angular.module("ccCombatApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);